<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>연구 모형 다이어그램</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.min.css">
<style>
  :root{
    --rail-offset: 160px; /* 오른쪽 레일 간격 */
    --line:#444; --bg:#f6f7f9;
  }
  body {
    margin:0; background:var(--bg); font-family:'Pretendard',sans-serif;
    display:flex; justify-content:center; align-items:center; min-height:100vh;
  }
  .diagram {
    position:relative; width:980px; height:620px;
    border:2px solid var(--line); border-radius:6px; background:#fff;
    overflow:visible;
  }
  .badge, .box {
    position:absolute; background:#fff; border:1.5px solid var(--line);
    border-radius:8px; padding:10px 14px; font-size:16px;
    white-space:nowrap; box-shadow:0 2px 6px rgba(0,0,0,.05);
  }
  .badge { font-weight:600; z-index:2; }

  /* 표준화/맞춤화는 살짝 우측으로 */
  #std{ top:-56px; left:60%; transform:translateX(-50%);} 
  #cust{ bottom:-56px; left:60%; transform:translateX(-50%);} 

  /* 오른쪽 레일(두 박스 중심 정렬) */
  #intent{ top:110px; left:calc(100% + var(--rail-offset)); transform:translateX(-50%);} 
  #wom{ bottom:110px; left:calc(100% + var(--rail-offset)); transform:translateX(-50%);} 

  .box.small{ font-size:15px; }
  .sub{ list-style:none; margin:6px 0 0; padding:0; font-size:14px; line-height:1.5;}
  #platform{ top:-18px; left:190px; }

  svg.edges{ position:absolute; inset:0; pointer-events:none; overflow:visible; }
  .edge{ stroke:var(--line); stroke-width:2; }
  .label{
    font-size:13px; fill:#111; font-weight:600;
    text-anchor:start; dominant-baseline:middle;
    /* ⬇️ 선과 겹쳐도 가독성 유지 */
    paint-order: stroke fill;
    stroke: #fff; stroke-width:4px; stroke-linejoin:round;
  }
</style>
</head>
<body>
<div class="diagram" id="stage">
  <!-- 바깥 배지 -->
  <div class="badge" id="std">표준화</div>
  <div class="badge" id="cust">맞춤화</div>
  <div class="badge" id="intent">지속적 사용 의도</div>
  <div class="badge" id="wom">구전</div>

  <!-- 내부 박스 -->
  <div class="box" id="platform">AI 서비스 플랫폼</div>
  <div class="box small" id="info" style="top:150px; left:50px;">
    AI 정보 품질
    <ul class="sub"><li>· 완성도</li><li>· 정확성</li><li>· 구성</li></ul>
  </div>
  <div class="box small" id="system" style="top:350px; left:50px;">
    AI 시스템 품질
    <ul class="sub"><li>· 신뢰도</li><li>· 융통성</li><li>· 시기적절함</li></ul>
  </div>
  <div class="box" id="recommend" style="top:270px; left:400px;">AI 추천 품질</div>
  <div class="box" id="satisfaction" style="top:270px; left:670px;">AI 서비스 만족</div>

  <!-- SVG 연결선 -->
  <svg class="edges">
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#444"></path>
      </marker>
    </defs>

    <!-- H1~H5 -->
    <g class="edge-group" data-from="info" data-to="recommend" data-label="H1" data-mode="RL"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" data-from="system" data-to="recommend" data-label="H2" data-mode="RL"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" id="edge-h3" data-from="recommend" data-to="satisfaction" data-label="H3" data-mode="RL"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" id="edge-h4" data-from="satisfaction" data-to="intent" data-label="H4" data-mode="RL"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" id="edge-h5" data-from="satisfaction" data-to="wom" data-label="H5" data-mode="RL"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>

    <!-- intent -> wom (수직 연결) -->
    <g class="edge-group" data-from="intent" data-to="wom" data-label="" data-mode="BT-TB">
      <line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>

    <!-- H7a/H7b/H7c -->
    <g class="edge-group" data-from="std" data-to="H3MID" data-label="H7a" data-mode="BT-TB"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" data-from="std" data-to="wom"   data-label="H7b" data-mode="BT"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" data-from="std" data-to="H4MID" data-label="H7c" data-mode="BT"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>

    <!-- H8a/H8b/H8c -->
    <g class="edge-group" data-from="cust" data-to="H3MID" data-label="H8a" data-mode="TB-BT"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" data-from="cust" data-to="intent" data-label="H8b" data-mode="TB"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
    <g class="edge-group" data-from="cust" data-to="H5MID" data-label="H8c" data-mode="TB"><line class="edge" marker-end="url(#arrow)"/><text class="label"/></g>
  </svg>
</div>

<script>
(function(){
  const stage=document.getElementById('stage');
  const svg=stage.querySelector('svg.edges');

  const rectOf=el=>el.getBoundingClientRect();
  const stageRect=()=>stage.getBoundingClientRect();
  function centerRight(el){const r=rectOf(el),s=stageRect();return{x:r.right-s.left,y:r.top-s.top+r.height/2};}
  function centerLeft (el){const r=rectOf(el),s=stageRect();return{x:r.left -s.left,y:r.top-s.top+r.height/2};}
  function centerTop  (el){const r=rectOf(el),s=stageRect();return{x:r.left -s.left+r.width/2,y:r.top-s.top};}
  function centerBottom(el){const r=rectOf(el),s=stageRect();return{x:r.left -s.left+r.width/2,y:r.bottom-s.top};}
  const midpoint=(p,q)=>({x:(p.x+q.x)/2,y:(p.y+q.y)/2});

  /* 라벨별 오프셋 */
  const labelOffset = {
    default: { dx: 12, dy: -6 },
    H4:      { dx: 12, dy: -20 },
    H2:      { dx: -20, dy: 10 },  // ⬅️ 좌측 아래로 이동
    H5:      { dx: -20, dy: -20 },
    H8c:     { dx: 40, dy: -22 }
  };

  function draw(g){
    const fromId=g.dataset.from,toId=g.dataset.to,label=g.dataset.label||'',mode=g.dataset.mode||'RL';
    const fromEl=document.getElementById(fromId);
    let p,q;

    if(['H3MID','H4MID','H5MID'].includes(toId)){
      const hx=+g.dataset.hx,hy=+g.dataset.hy;
      if(mode==='TB') p=centerTop(fromEl);
      else if(mode==='BT') p=centerBottom(fromEl);
      else if(mode==='BT-TB'){ p=centerBottom(fromEl); }
      else if(mode==='TB-BT'){ p=centerTop(fromEl); }
      else p=centerRight(fromEl);
      q={x:hx,y:hy};
    }else{
      const toEl=document.getElementById(toId);
      if(mode==='TB')      { p=centerTop(fromEl);    q=centerLeft(toEl); }
      else if(mode==='BT') { p=centerBottom(fromEl); q=centerLeft(toEl); }
      else if(mode==='BT-TB'){ p=centerBottom(fromEl); q=centerTop(toEl); }
      else if(mode==='TB-BT'){ p=centerTop(fromEl); q=centerBottom(toEl); }
      else { p=centerRight(fromEl); q=centerLeft(toEl); }
    }

    const line=g.querySelector('line.edge');
    line.setAttribute('x1',p.x); line.setAttribute('y1',p.y);
    line.setAttribute('x2',q.x); line.setAttribute('y2',q.y);

    const mid=midpoint(p,q);
    const t=g.querySelector('text.label');
    t.textContent=label;

    const off = labelOffset[label] || labelOffset.default;
    t.setAttribute('x', mid.x + off.dx);
    t.setAttribute('y', mid.y + off.dy);
  }

  function updateEdges(){
    const groups=[...svg.querySelectorAll('.edge-group')];
    groups.forEach(g=>{
      if(['H3MID','H4MID','H5MID'].includes(g.dataset.to)) return;
      draw(g);
    });
    function lineMid(id){
      const g=document.getElementById(id); if(!g) return null;
      const l=g.querySelector('line.edge');
      const x1=+l.getAttribute('x1'),y1=+l.getAttribute('y1');
      const x2=+l.getAttribute('x2'),y2=+l.getAttribute('y2');
      return {x:(x1+x2)/2,y:(y1+y2)/2};
    }
    const H3MID=lineMid('edge-h3');
    const H4MID=lineMid('edge-h4');
    const H5MID=lineMid('edge-h5');
    groups.forEach(g=>{
      if(g.dataset.to==='H3MID'&&H3MID){g.dataset.hx=H3MID.x;g.dataset.hy=H3MID.y;draw(g);}
      if(g.dataset.to==='H4MID'&&H4MID){g.dataset.hx=H4MID.x;g.dataset.hy=H4MID.y;draw(g);}
      if(g.dataset.to==='H5MID'&&H5MID){g.dataset.hx=H5MID.x;g.dataset.hy=H5MID.y;draw(g);}
    });
  }

  window.addEventListener('load',updateEdges);
  window.addEventListener('resize',updateEdges);
  document.fonts&&document.fonts.ready.then(updateEdges);
})();
</script>
</body>
</html>
